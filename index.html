<!DOCTYPE html>
<html>
  <head>
    <title>BLE Time Sync</title>
  </head>
  <body>
    <h1>Sync Time to ESP32 via BLE</h1>
    <button onclick="connectBLE()">Connect & Send Time</button>

    <script>
      const serviceUUID = "4fafc201-1fb5-459e-8fcc-c5c9c331914b";
      const characteristicUUID = "beb5483e-36e1-4688-b7f5-ea07361b26a8";

      async function connectBLE() {
        try {
          const device = await navigator.bluetooth.requestDevice({
            acceptAllDevices: true,
            optionalServices: [serviceUUID],
          });

          const server = await device.gatt.connect();
          const service = await server.getPrimaryService(serviceUUID);
          const characteristic = await service.getCharacteristic(characteristicUUID);

          const now = new Date();
          const message = `SETTIME,${now.getDate()},${now.getMonth() + 1},${now.getFullYear()},${now.getHours()},${now.getMinutes()},${now.getSeconds()}`;
          const encoder = new TextEncoder();
          await characteristic.writeValue(encoder.encode(message));

          alert("Waktu berhasil dikirim ke ESP32 via BLE!");
        } catch (error) {
          console.error(error);
          alert("Gagal terhubung: " + error);
        }
      }
    </script>
  </body>
</html>
